## 五. 浏览器相关
### 1. 浏览器输入URL后HTTP请求返回的过程
### 2. 输入url到页面加载都发生了什么？:star::star::star::star::star:（超高频）
> 这个是个经典的面试题，可以比较全面地考察应聘者只是的掌握程度，其中涉及到了*网络*
，*操作系统*，Web等一系列问题！

这是一个完整的**导航流程**，他是网络加载流程和渲染流程之间的一座桥梁，如果理解导航流程，就能完整地串起来整个页面显示流程，对于理解浏览器的工作原理起到了点睛的作用

#### 导航流程里含括的几个流程
- **浏览器进程**
  - 主要负责用户交互、子进程管理和文件储存等功能
- **网络进程**
  - 面向渲染进程和浏览器进程等，**提供网络下载**功能
- **渲染进程**
  - 把网络下载的HTML、JavaScript、CSS、图片等资源**解析**为可以显示和交互的**页面**
  - **运行在渲染进程里的代码都是不被信任的**，因为渲染进程所有的内容都来自于网络，会存在一些恶意代码利用浏览器漏洞对系统进行攻击。这也是为什么Chrome会让渲染进程运行在安全沙箱里，就是为了保证系统的安全
  
#### 流程解答（粗略）

1. 用户从浏览器进程里输入请求信息
2. 网络进程发起URL请求
3. 服务器响应URL请求后，浏览器进行开始准备渲染进程
4. 渲染进程准备好了之后，需要向渲染进程提交页面数据，就是**提交文档**阶段
5. 渲染进程接收文档信息后，就开始解析页面和加载子资源，完成页面的渲染

#### 详细解答
1. 用户输入url并回车
2. 浏览器进程**检查url，组装协议，构成完整的url**
3. 浏览器进程通过进程间通信（IPC），**把url请求发送给网络进程**
4. 网络进程接收到url请求后检查本地缓存**是否缓存**了该请求资源，如果有，则将资源返回给浏览器进程；如果没有，网络进程向web服务器发起http请求（网络请求）
   **网络请求流程**：
   1. 进行DNS解析，获取服务器IP地址，端口
   2. 利用IP地址和服务器建立tcp连接
   3. 构建请求头信息
   4. 发送请求头信息
   5. 服务器响应后，网络进程接口响应头和响应信息，并解析响应内容
      **解析响应内容流程**：
        1. 检查状态码，如果是301/302，就需要重定向，从缓存中读取地址，如果是200就继续处理请求
        2. 200 响应处理：检查响应类型Content-Type，如果是**字节流类型**，则将该请求提交给下载管理器，该**导航流程结束**，不在进行后续的渲染；如果是html，则通知浏览器进程准备**渲染进程**，并准备进行渲染；
    6. **准备渲染进程**：
       1. 浏览器进程检查当前url是否和之前打开的渲染进程根域名相同，如果相同，就复用原来的进程；不同，就开启新的渲染进程
    7. **传输数据、更新状态**
       1. 渲染进程准备好后，浏览器向渲染进程发起“提交文档”的消息，渲染进程接收到消息和网络进程建立传输数据的管道
       2. 渲染进程接收完数据后，向浏览器发送“确认提交”
       3. 浏览器进程接收到确认消息后，**更新浏览器界面状态**：安全、地址栏url、前进后退的历史状态、更新web页面。

> 关于**渲染进程**
> Chrome默认采用每个标签对应一个渲染进程，但是如果两个页面属于同一站点，那这两个标签就会使用同一个渲染进程

#### 参考资料
- [导航流程：从输入URL到页面展示这中间发生了什么——(浏览器工作原理与实践)](https://blog.poetries.top/browser-working-principle/guide/part1/lesson04.html)
### 3. 在使用缓存后，代码更新js资源，但是客户端没有更新，要怎么解决？

可以在**资源链接上加个时间戳**，如果服务端更新了，就更新一下那个时间戳，这样就可以确保客户端的资源可以及时更新了，因为时间戳都不一样，浏览器即使缓存了也是旧的时间戳，也是得重新向服务器请求的。

### 4. 一个图片url访问后直接下载怎么实现？（:sob:我没看懂！！！）

几种方法：
1. 设置响应头：Content-type
2. download属性（h5新增的属性）

网上答案：（先抄，但不懂:sob:）

请求的返回头里面，用于浏览器解析的重要参数就是OSS的API文档里面的返回http头，决定用户下载行为的参数。
下载的情况下：
```

  1. x-oss-object-type:
         Normal
  2. x-oss-request-id:
         598D5ED34F29D01FE2925F41
  3. x-oss-storage-class:
         Standard
```
