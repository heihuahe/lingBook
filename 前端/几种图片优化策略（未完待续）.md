---
title: 几种图片优化策略
tags: 图片
notebook: 前端
---
# 几种图片优化策略
上次，我们讲过，要从图片本身分析，采用合适的图片格式从而优化图片的资源加载。这次，我们来聊一聊其他角度的优化图片策略。

在网页中，其加载的大部分资源（60%）就是图片资源了，所以优化图片通常可以有效的减少字节数和改价网站的性能，原理就是：浏览器需要下载的字节数越少，对客户端带宽的争用就越少，浏览器下载内容并在屏幕上呈现的内容的速度就越快。速度快，性能就肉眼可见的感觉好了很多。

有这么几个方面需要考虑：
- 要编码的数据类型
- 图片格式功能
- 质量设置
- 分辨率
- 是否最好以矢量格式提供某些图片
- 是否可以通过css实现所需效果?
- 如何为每类设备传送已进行相应调整的资源

# 举例
- 压缩
  - 图片较大，就要压缩。或者采用cdn
- 合并
  - 比较小的图片，可以做成雪碧图或者直接生成base64编码嵌入网页中，或者在网站上使用webp格式的图片（在移动端用的多）
  - 雪碧图，也不宜过大，200k左右就差不多。
- CDN
  - 图片较大时，建议采用，就是把图片放到阿里OSS或者七牛云里。
- 缓存
- 延时加载
- 独立域名

### 恰当的使用图片资源
在优化现有的图片资源之前，先思考一下，**当前网站/页面的图片都是必要的吗？可以用css实现吗？**
如果你的回答是：是，都是必要的，且无法用css实现。那么你可以跳过这一节。
好的设计是简单而且始终可以提供最佳效果的。相比于图片资源，html、css、js等所需要加载的字节数始终是更少，用这些来替代图片资源无疑是最佳的方法（当然，这是指简单的图片及图形）。所以在实现相同效果的情况下，先思考一下，能不能用css或其他方法实现。  
简单的图片一般来说，有这么几种：基础的图形，颜色简单的图标。  
可以采取的策略有：
  - css效果(渐变、阴影等)和css动画。
    - 这些都可以用于生成与分辨率无关的资源，而且在任何分辨率和缩放级别下始终都能清晰地显示，最重要的是，这些所需要的字节数往往只是图片资源的几分之一而已。
  - 网页字体

### 选择合适的格式
这时候，你已经确定好了，剩下的都是需要图片才能实现的效果，那么就来考虑一下，哪个是这个图片最适合的格式？恰当的图片格式会相对地减少一些不必要的字节数，减少图片大小。(这个，我们上一次已经大致了解过了，现在来简单总结归纳一下，如果还不太清楚，[点击了解一下]())  
图片主要分为两大类：矢量图和位图（栅格）
- 矢量图：使用点、线、多边形来表示图片，缩放不失真；
  - 适合包含简单几何图形的图像，比如：图标、徽标等。
- 位图：根据像素点进行生成图片，缩放会失真；
  - 适合复杂，细节度高，色彩丰富的图片。
### 一倍图和两倍图

### 图片处理
已经将图片控制到相对来说较小的大小了，但是图片一多的话，网站的效果还是挺差的，加载依旧很慢，那怎么办呢？来看看吧。
- js
  - 懒加载
    - 使用jq的lazyload插件实现图片懒加载，就是等到滚动条滚动到对应的地方再加载所需要的图片资源；
  - 渐进式图片加载（progressive-image）
    - 用低分辨率的模糊图片来做预览图，代替懒加载的logo占位图。用canvas画出预览图。一般大小平均就在2-3kb之间，用户体验较好。
- css 
  - 雪碧图
    - 将简单的小图片做成雪碧图，多个图片合到一个雪碧图上，减少图片资源的请求。
    - 雪碧图的话，如果图片都是单色的，可以考虑用icon-font来实现；或者直接在页面写svg代码和转换成base64写到页面上去。
  - 用css 的devicePixelRatio检查设备的像素比,恰当的使用倍图。
    - 区分设备是视网膜设备还是非视网膜设备，从而来决定加载两倍图还是原始大小的图片。
- 其他
  - 在保证不失真的情况下，用gulp-imagemin工具来压缩图片大小。
### 参考资料
- [优化图片 (PageSpeed Tools > Insights)](https://developers.google.com/speed/docs/insights/OptimizeImages)
- [图像优化(google developers —— ILya Grigorik)](https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/image-optimization#image_optimization_checklist)
- [适用于 vue.js 和原生 js 的渐进式图片加载(GitHub —— ccforward)](https://github.com/ccforward/cc/issues/64)


